<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hrp.auth.mapper.ProcessVariableMapper">

    <resultMap id="BaseResultMap" type="com.hrp.common.entity.ProcessVariable">
        <id column="variable_id" property="variableId"/>
        <result column="process_instance_id" property="processInstanceId"/>
        <result column="variable_key" property="variableKey"/>
        <result column="variable_value" property="variableValue"/>
        <result column="variable_type" property="variableType"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <select id="selectByInstanceId" resultMap="BaseResultMap">
        SELECT * FROM wf_process_variable WHERE process_instance_id = #{processInstanceId}
        ORDER BY variable_key ASC
    </select>

    <select id="selectByInstanceIdAndKey" resultMap="BaseResultMap">
        SELECT * FROM wf_process_variable 
        WHERE process_instance_id = #{processInstanceId} AND variable_key = #{variableKey}
    </select>

    <insert id="insert" parameterType="com.hrp.common.entity.ProcessVariable">
        INSERT INTO wf_process_variable (process_instance_id, variable_key, variable_value, variable_type, create_time)
        VALUES (#{processInstanceId}, #{variableKey}, #{variableValue}, #{variableType}, NOW())
        ON DUPLICATE KEY UPDATE variable_value = #{variableValue}, variable_type = #{variableType}, update_time = NOW()
    </insert>

    <update id="updateById" parameterType="com.hrp.common.entity.ProcessVariable">
        UPDATE wf_process_variable
        <set>
            <if test="variableValue != null">variable_value = #{variableValue},</if>
            <if test="variableType != null">variable_type = #{variableType},</if>
            update_time = NOW()
        </set>
        WHERE variable_id = #{variableId}
    </update>

    <delete id="deleteById">
        DELETE FROM wf_process_variable WHERE variable_id = #{variableId}
    </delete>

    <delete id="deleteByInstanceId">
        DELETE FROM wf_process_variable WHERE process_instance_id = #{instanceId}
    </delete>

</mapper>



